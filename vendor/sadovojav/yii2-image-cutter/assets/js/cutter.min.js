$.fn.cutter=function(t){"use strict";function a(t){var a=h.find("img").prop("outerHTML");h.html("").append(a),$("#"+l).prop("src",t.target.result.toString()).hide(),p.on("shown.bs.modal",function(t){var a=e();h.css({width:a.width+"px",height:a.height+"px"});var o=$.extend({},n,w);$("#"+l).cropper(o)}),p.modal("show")}function e(){var t,a=1,e=h.width(),o=100,i=$("#"+l).width(),r=$("#"+l).height();return i>r&&(a=i/e,t=r/a),r>i&&(e>i?(e=i,t=r):(a=i/e,t=r/a)),i==r&&(t=e>i?r:e,o>t&&(t=o)),d&&(t=$(window).height()-300),{width:e,height:t}}var o=!1,i=$(this),r=t.inputField,n=t.cropperOptions,d=t.useWindowHeight,c=$("#"+r+"-cutter"),p=c.find(".modal"),h=c.find(".image-container"),l=h.find("img").attr("id"),s=c.find(".preview-image"),f=$("#"+r+"-dataX"),v=$("#"+r+"-dataY"),g=$("#"+r+"-dataHeight"),u=$("#"+r+"-dataWidth"),m=$("#"+r+"-dataRotate"),w={crop:function(t){f.val(Math.round(t.x)),v.val(Math.round(t.y)),g.val(Math.round(t.height)),u.val(Math.round(t.width)),m.val(Math.round(t.rotate))}};c.on("click","[data-method]",function(){var t,a,e=$(this).data(),o=$(this).closest(".modal"),i=o.find(".image-container"),r=i.find("img").attr("id");if(e.method){if(e=$.extend({},e),"undefined"!=typeof e.target&&(t=$(e.target),"undefined"==typeof e.option&&"setAspectRatio"==e.method)){var n=t.val().replace("/D/+/g",""),d=n.split("/");2==d.length?e.option=d[0]/d[1]:e.option=parseFloat(t.val())}if("setData"==e.method&&(e.option={x:parseFloat(f.val()),y:parseFloat(v.val()),width:parseFloat(u.val()),height:parseFloat(g.val()),rotate:parseFloat(m.val())}),a=$("#"+r).cropper(e.method,e.option),console.log(r),$.isPlainObject(a)&&t)try{t.val(JSON.stringify(a))}catch(c){console.log(c.message)}}return!1}),i.change(function(t){var e=t.target.files[0],o=/image.*/;if(e.type.match(o)){var i=new FileReader;i.onload=a,i.readAsDataURL(e)}}),$("#"+l+"_button_accept").on("click",function(){var t=$("#"+l).cropper("getData");if($.each(t,function(){0!=this&&(o=!0)}),o){var a=$("#"+l).cropper("getCroppedCanvas"),e=a.toDataURL();s.prop("src",e)}p.modal("hide")}),$("#"+l+"_button_cancel").on("click",function(){p.modal("hide")}),p.on("hidden.bs.modal",function(){o||(s.prop("src",$("#"+l).prop("src")),s.attr("src",""),$("#"+r).replaceWith($("#"+r).val("").clone(!0))),o=!1,h.find(".cropper-container").remove(),$("#"+l).removeAttr("src").removeAttr("style").removeClass("cropper-hidden")})};